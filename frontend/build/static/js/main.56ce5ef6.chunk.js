(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{157:function(e,t,a){e.exports=a(320)},320:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),s=a(67),i=a.n(s),l=a(23),o=a(19),c=a(44),u=a(142),m=a.n(u),d=a(143),p=a.n(d),h=a(10),f=Object(c.c)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"USER_LOGIN":case"USER_AUTH":return Object(h.a)({},e,{login:t.payload});case"GET_USER":return Object(h.a)({},e,{users:t.payload});case"USER_REGISTER":return Object(h.a)({},e,{register:t.payload.success,users:t.payload.users});default:return e}},societes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_SOCIETES":case"CLEAR_SOCIETES":return Object(h.a)({},e,{list:t.payload});case"GET_SOCIETE":return Object(h.a)({},e,{societe:t.payload});case"ADD_SOCIETE":case"CLEAR_NEWSOCIETE":return Object(h.a)({},e,{newSociete:t.payload});case"UPDATE_SOCIETE":return Object(h.a)({},e,{updateSociete:t.payload.success,societe:t.payload.doc});case"DELETE_SOCIETE":return Object(h.a)({},e,{deleted:t.payload});default:return e}},formulaires:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_FORMULAIRESBYSOCIETE":return Object(h.a)({},e,{list:t.payload});case"GET_FORMULAIRE":return Object(h.a)({},e,{formulaire:t.payload});case"CLEAR_FORMULAIRE":return Object(h.a)({},e,{list:t.payload});case"ADD_FORMULAIRE":case"CLEAR_NEWFORMULAIRE":return Object(h.a)({},e,{newFormulaire:t.payload});case"UPDATE_FORMULAIRE":return Object(h.a)({},e,{updateFormulaire:t.payload.success,formulaire:t.payload.doc});case"DELETE_FORMULAIRE":return Object(h.a)({},e,{deleted:t.payload});default:return e}}}),E=a(12),v=a(13),b=a(15),C=a(14),g=a(16),y=a(156),S=a(21),F=a.n(S);function O(){return{type:"GET_USER",payload:F.a.get("/api/users").then(function(e){return e.data})}}function I(e){return{type:"GET_SOCIETE",payload:F.a.get("/api/getSociete",{params:{id:e}}).then(function(e){return e.data})}}function N(e,t){return{type:"GET_FORMULAIRESBYSOCIETE",payload:F.a.get("/api/formulairesBySociete",{params:{id:e,order:t}}).then(function(e){return e.data.map(function(e){return Object(h.a)({},e,{EBITDA:e.CA-e.FA-e.CS-e.FG-e.AF})})})}}function A(e){return{type:"ADD_FORMULAIRE",payload:F.a.post("/api/formulaire",e).then(function(e){return e.data})}}var j=a(42),D=a.n(j),_=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).renderFormulaireQuick=function(e){return e.list?e.list.filter(function(e){var t=new Date(e.date);return t>=a.state.dateBegin&&t<=a.state.dateEnd}).map(function(e){return r.a.createElement("tr",{key:e._id},r.a.createElement("td",{className:"Date"},new Date(e.date).toLocaleDateString()),r.a.createElement("td",{className:"Button"},r.a.createElement("a",{onClick:function(){return a.handleFormulaireEdit(e._id)}},a.isUserSocAdmin()?"Editer":"Voir")))}):null},a.handleFormulaireEdit=function(e){a.props.history.push("/formulaire/".concat(e))},a.isUserSocAdmin=function(){return!!a.props.societe&&!!a.props.societe.admins.some(function(e){return e===a.props.user.login.id})},a.handleDateStart=function(e){var t=new Date(e.target.value);t instanceof Date&&isFinite(t)?a.setState(Object(h.a)({},a.state,{dateBegin:t})):a.setState(Object(h.a)({},a.state,{dateBegin:new Date("1970-01-01")}))},a.handleDateEnd=function(e){var t=new Date(e.target.value);t instanceof Date&&isFinite(t)?a.setState(Object(h.a)({},a.state,{dateEnd:t})):a.setState(Object(h.a)({},a.state,{dateEnd:new Date("3000-01-01")}))},a.state={dateBegin:new Date("1970-01-01"),dateEnd:new Date("3000-01-01")},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"FQV"},r.a.createElement("div",{className:"Head"},r.a.createElement("div",{className:"Info"},r.a.createElement("div",null,r.a.createElement("div",{style:{fontWeight:"600"}},"Adresse"),r.a.createElement("div",{style:{fontWeight:"600"}},"Personne de contact")),r.a.createElement("div",null,r.a.createElement("div",null,"   :   "),r.a.createElement("div",null,"   :   ")),r.a.createElement("div",null,r.a.createElement("div",null,this.props.societe.adresse&&""!==this.props.societe.adresse?this.props.societe.adresse:"Non renseign\xe9e"),r.a.createElement("div",null,this.props.societe.PDC&&""!==this.props.societe.PDC?this.props.societe.PDC:"Non renseign\xe9e"))),r.a.createElement("div",{className:"Buttons"},r.a.createElement(l.b,{className:"Btn",to:"/societe/".concat(this.props.societe._id)},r.a.createElement(D.a,{name:"edit"})),r.a.createElement(l.b,{className:"Btn",to:"/societeGraph/".concat(this.props.societe._id)},r.a.createElement(D.a,{name:"line-chart"})))),r.a.createElement("div",{className:"Body"},r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"DateHeader"},r.a.createElement("div",{className:"DateInputs"},r.a.createElement("label",{style:{display:"inline-block",width:"2em"}},"Du "),r.a.createElement("input",{type:"date",onChange:this.handleDateStart})),r.a.createElement("div",{className:"DateInputs"},r.a.createElement("label",{style:{display:"inline-block",width:"2em"}},"au "),r.a.createElement("input",{type:"date",onChange:this.handleDateEnd}))),r.a.createElement("th",null,this.isUserSocAdmin()?r.a.createElement(l.b,{className:"ButtonNew",style:{display:"block"},to:"/addFormulaires/".concat(this.props.societe._id)},"Nouveau formulaire"):null))),r.a.createElement("tbody",null,this.renderFormulaireQuick(this.props.formulaires)))))}}]),t}(n.Component),T=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).handleselectedFile=function(e){a.setState({selectedFile:e.target.files[0],loaded:0})},a.submitForm=function(e){if(e.preventDefault(),a.state.selectedFile){var t=new FormData;t.append("file",a.state.selectedFile,a.state.selectedFile.name),t.append("societeId",a.props.societeId),F.a.post("/api/CSVFormulaires",t,{onUploadProgress:function(e){a.setState({loaded:e.loaded/e.total*100})}}).then(function(e){a.props.refreshFormulaires()})}},a.getFormulairesCsv=function(){F.a.get("/api/CSVformulairesBySociete",{params:{id:a.props.societeId,order:"asc"}}).then(function(e){console.log(e);var t="http://"+window.location.hostname;window.open(t+e.data)})},a.isUserSocAdmin=function(){return!!a.props.societe&&!!a.props.societe.admins.some(function(e){return e===a.props.user.login.id})},a.state={selectedFile:null,loaded:0},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,this.isUserSocAdmin()?r.a.createElement("div",{className:"CSVContainer"},r.a.createElement("form",{onSubmit:this.submitForm},r.a.createElement("h2",null,"Import/export de formulaires CSV"),r.a.createElement("label",{htmlFor:"file",className:"labelFile",onClick:function(t){return e.refs.inputFile.click()}},"S\xe9lectionner le fichier CSV"),r.a.createElement("input",{type:"file",name:"file",className:"inputFile",onChange:this.handleselectedFile,ref:"inputFile"}),r.a.createElement("div",{className:"Btn"},r.a.createElement("a",{onClick:this.submitForm},"Uploader")),r.a.createElement("p",null,Math.round(this.state.loaded,2)," % upload\xe9")),r.a.createElement("div",{className:"Buttons"},r.a.createElement("div",{className:"Btn"},r.a.createElement("a",{onClick:this.getFormulairesCsv},"Obtenir les formulaires au format CSV")))):null)}}]),t}(n.Component),k=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).handleSelectSociete=function(e){a.setState({selectedSocieteId:e.target.value}),a.props.dispatch(N(e.target.value,"desc"))},a.renderSocietes=function(e){return e.list&&e.list.length?e.list.map(function(e){return r.a.createElement("option",{key:e._id,value:e._id},e.name)}):null},a.getSelectedSociete=function(){return a.props.societes.list?a.props.societes.list.filter(function(e){return e._id===a.state.selectedSocieteId})[0]:null},a.refreshFormulaires=function(){a.props.dispatch(N(a.state.selectedSocieteId,"desc"))},a.state={selectedSocieteId:""},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"componentWillMount",value:function(){this.props.user&&this.props.dispatch({type:"GET_SOCIETES",payload:F.a.get("/api/societesByUser").then(function(e){return e.data})})}},{key:"render",value:function(){return r.a.createElement("div",{className:"PageContent"},r.a.createElement("form",null,r.a.createElement("div",{className:"SS"},r.a.createElement("label",{htmlFor:"societeSelect"},"Choisissez la soci\xe9t\xe9"),r.a.createElement("select",{id:"societeSelect",value:this.state.selectedSocieteId,onChange:this.handleSelectSociete},r.a.createElement("option",{value:""}),this.renderSocietes(this.props.societes)))),""!==this.state.selectedSocieteId?r.a.createElement(_,Object.assign({formulaires:this.props.formulaires,societe:this.getSelectedSociete()},this.props)):null,""!==this.state.selectedSocieteId?r.a.createElement(T,Object.assign({societeId:this.state.selectedSocieteId,societe:this.getSelectedSociete(),refreshFormulaires:this.refreshFormulaires},this.props)):null)}}]),t}(n.Component);var w=Object(o.b)(function(e){return{societes:e.societes,formulaires:e.formulaires}})(k),U=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).handleInputEmail=function(e){a.setState({email:e.target.value})},a.handleInputPassword=function(e){a.setState({password:e.target.value})},a.submitForm=function(e){e.preventDefault(),a.props.dispatch(function(e){var t=e.email,a=e.password;return{type:"USER_LOGIN",payload:F.a.post("/api/login",{email:t,password:a}).then(function(e){return e.data})}}(a.state))},a.state={email:"",password:"",error:"",success:!1},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.user.login.isAuth&&this.props.history.push("/")}},{key:"render",value:function(){var e=this.props.user;return r.a.createElement("div",{className:"PageContent"},r.a.createElement("div",{className:"rl_container article"},r.a.createElement("form",{onSubmit:this.submitForm},r.a.createElement("h2",null,"Veuillez vous connecter"),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"email",placeholder:"Adresse email",value:this.state.email,onChange:this.handleInputEmail})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"password",placeholder:"Mot de passe",value:this.state.password,onChange:this.handleInputPassword})),r.a.createElement("button",{type:"submit"},"Connexion"),r.a.createElement("div",{className:"error"},e.login?r.a.createElement("div",null,e.login.message):null))))}}]),t}(n.Component);var B=Object(o.b)(function(e){return{user:e.user}})(U),R=function(e){F.a.get("/api/logout").then(function(t){setTimeout(function(){e.history.push("/")},1e3)});return r.a.createElement("div",{className:"logout_container"},r.a.createElement("h1",null,"D\xe9connexion en cours"))},x=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).submitForm=function(e){var t;e.preventDefault(),a.props.dispatch((t=Object(h.a)({},a.state.formData,{admins:[a.props.user.login.id]}),{type:"ADD_SOCIETE",payload:F.a.post("/api/societe",t).then(function(e){return e.data})})),a.props.history.push("/")},a.handleChange=function(e,t){var n=Object(h.a)({},a.state.formData);n[t]=e.target.value,a.setState({formData:n})},a.state={formData:{name:"",adresse:"",PDC:""}},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"PageContent"},r.a.createElement("div",{className:"rl_container article"},r.a.createElement("form",{onSubmit:this.submitForm},r.a.createElement("h2",null,"Nouvelle soci\xe9t\xe9"),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"text",placeholder:"Nom",value:this.state.formData.name,onChange:function(t){return e.handleChange(t,"name")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"text",placeholder:"Adresse",value:this.state.formData.adresse,onChange:function(t){return e.handleChange(t,"adresse")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"text",placeholder:"Personne de contact",value:this.state.formData.PDC,onChange:function(t){return e.handleChange(t,"PDC")}})),r.a.createElement("button",{type:"submit"},"Enregistrer"))))}}]),t}(n.Component);var P=Object(o.b)(function(e){return{societe:e.societes}})(x),G=a(55),L=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).convertDateToHtml=function(e){var t=new Date(e),a=("0"+(t.getMonth()+1)).slice(-2),n=("0"+t.getDate()).slice(-2);return t.getFullYear()+"-"+a+"-"+n},a.handleNumInput=function(e,t){var n=""!==e.target.value?parseInt(e.target.value):"",r=a.state;r[t]=n,r.EBITDA=r.CA-r.FA-r.CS-r.FG-r.AF,a.setState(r)},a.handleDateInput=function(e,t){a.setState(Object(G.a)({},t,e.target.value)),console.log("NEW DATE IS: "+e.target.value)},a.submitForm=function(e){e.preventDefault();var t=Object(h.a)({},a.state);for(var n in t.date=new Date(t.date).toJSON(),t)""===t[n]&&delete t[n];a.props.saveFormulaire(t)},e.formulaire?a.state={_id:e.formulaire._id,societeId:e.formulaire.societeId,date:a.convertDateToHtml(e.formulaire.date),CA:e.formulaire.CA,FA:e.formulaire.FA,CS:e.formulaire.CS,FG:e.formulaire.FG,AF:e.formulaire.AF,EBITDA:e.formulaire.EBITDA,CCT:e.formulaire.CCT,CLT:e.formulaire.CLT,CF:e.formulaire.CF,Inv:e.formulaire.Inv}:a.state={_id:"",societeId:a.props.societeId,date:"",CA:"",FA:"",CS:"",FG:"",AF:"",EBITDA:"",CCT:"",CLT:"",CF:"",Inv:""},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"EditForm"},r.a.createElement("form",{onSubmit:this.submitForm},r.a.createElement("h2",null,"Edition du formulaire"),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Date : "),r.a.createElement("input",{id:"dateIn",type:"date",value:this.state.date,onChange:function(t){return e.handleDateInput(t,"date")},disabled:this.props.disabled})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Chiffre d'affaire : "),r.a.createElement("input",{type:"number",placeholder:"Chiffre d'affaire",value:this.state.CA,onChange:function(t){return e.handleNumInput(t,"CA")},disabled:this.props.disabled})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Frais d'achats : "),r.a.createElement("input",{type:"number",placeholder:"Frais d'achats",value:this.state.FA,onChange:function(t){return e.handleNumInput(t,"FA")},disabled:this.props.disabled})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Charges salariales : "),r.a.createElement("input",{type:"number",placeholder:"Charges salariales",value:this.state.CS,onChange:function(t){return e.handleNumInput(t,"CS")},disabled:this.props.disabled})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Frais g\xe9n\xe9raux : "),r.a.createElement("input",{type:"number",placeholder:"Frais g\xe9n\xe9raux",value:this.state.FG,onChange:function(t){return e.handleNumInput(t,"FG")},disabled:this.props.disabled})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Autres frais : "),r.a.createElement("input",{type:"number",placeholder:"Autres frais",value:this.state.AF,onChange:function(t){return e.handleNumInput(t,"AF")},disabled:this.props.disabled})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"EBITDA : "),r.a.createElement("input",Object(G.a)({type:"number",placeholder:"EBITDA",value:this.state.EBITDA,onChange:function(t){return e.handleNumInput(t,"EBITDA")},disabled:this.props.disabled},"disabled",!0))),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Cr\xe9dits \xe0 court termes : "),r.a.createElement("input",{type:"number",placeholder:"Cr\xe9dits court termes",value:this.state.CCT,onChange:function(t){return e.handleNumInput(t,"CCT")},disabled:this.props.disabled})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Cr\xe9dits \xe0 long termes : "),r.a.createElement("input",{type:"number",placeholder:"Cr\xe9dits long termes",value:this.state.CLT,onChange:function(t){return e.handleNumInput(t,"CLT")},disabled:this.props.disabled})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Cashflow : "),r.a.createElement("input",{type:"number",placeholder:"Cashflow",value:this.state.CF,onChange:function(t){return e.handleNumInput(t,"CF")},disabled:this.props.disabled})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Investissements : "),r.a.createElement("input",{type:"number",placeholder:"Investissements",value:this.state.Inv,onChange:function(t){return e.handleNumInput(t,"Inv")},disabled:this.props.disabled})),"disabled"!==this.props.disabled?r.a.createElement("div",{className:"Buttons"},r.a.createElement("div",{className:"Btn"},r.a.createElement("a",{onClick:this.submitForm},"Enregistrer")),r.a.createElement("div",{className:"Btn"},r.a.createElement("a",{onClick:this.props.deleteFormulaire},"Supprimer le formulaire"))):null))}}]),t}(n.Component),M=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).sendUpdateFormulaire=function(e){var t;e._id?a.props.dispatch((t=e,{type:"UPDATE_FORMULAIRE",payload:F.a.post("/api/updateFormulaire",t).then(function(e){return e.data})})):a.props.dispatch(A(e)),a.props.history.push("/")},a.deleteFormulaire=function(){var e;window.confirm("Le formulaire va \xeatre supprim\xe9. \n\xcates-vous s\xfbr de votre choix? (ce changement est d\xe9finitif)")&&(a.props.dispatch((e=a.props.formulaire._id,{type:"DELETE_FORMULAIRE",payload:F.a.delete("/api/deleteFormulaire?id=".concat(e)).then(function(e){return e.data})})),a.props.history.push("/"))},a.isUserSocAdmin=function(){return!!a.props.societe&&!!a.props.societe.admins.some(function(e){return e===a.props.user.login.id})},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"componentWillMount",value:function(){var e,t=this;this.props.dispatch((e=this.props.match.params.id,{type:"GET_FORMULAIRE",payload:F.a.get("/api/getFormulaire",{params:{id:e}}).then(function(e){var t=e.data;return Object(h.a)({},t,{EBITDA:t.CA-t.FA-t.CS-t.FG-t.AF})})})).then(function(e){t.props.dispatch(I(e.payload.societeId))})}},{key:"renderFormulaire",value:function(){return this.props.formulaire?r.a.createElement(L,{key:this.props.formulaire._id,societeId:this.props.formulaire.societeId,saveFormulaire:this.sendUpdateFormulaire,deleteFormulaire:this.deleteFormulaire,formulaire:this.props.formulaire,disabled:this.isUserSocAdmin()?"":"disabled"}):null}},{key:"render",value:function(){return r.a.createElement("div",{className:"PageContent"},r.a.createElement("div",{className:"rl_container EditFormContainer"},this.renderFormulaire()))}}]),t}(n.Component);var W=Object(o.b)(function(e){return{formulaire:e.formulaires.formulaire,societe:e.societes.societe}})(M),H=function(e){var t=function(t,a){e.handleNum(e.formId,t.target.value,a)};return r.a.createElement("div",{className:"AddFormContainer"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault()}},r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{id:"dateIn",type:"date",value:e.date,onChange:function(t){return function(t,a){e.handleDate(e.formId,t.target.value,a)}(t,"date")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"number",placeholder:"Chiffre d'affaire",value:e.CA,onChange:function(e){return t(e,"CA")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"number",placeholder:"Frais d'achats",value:e.FA,onChange:function(e){return t(e,"FA")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"number",placeholder:"Charges salariales",value:e.CS,onChange:function(e){return t(e,"CS")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"number",placeholder:"Frais g\xe9n\xe9raux",value:e.FG,onChange:function(e){return t(e,"FG")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"number",placeholder:"Autres frais",value:e.AF,onChange:function(e){return t(e,"AF")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"number",placeholder:"EBITDA",value:e.EBITDA,onChange:function(e){return t(e,"EBITDA")},disabled:!0})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"number",placeholder:"Cr\xe9dits court terme",value:e.CCT,onChange:function(e){return t(e,"CCT")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"number",placeholder:"Cr\xe9dits long terme",value:e.CLT,onChange:function(e){return t(e,"CLT")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"number",placeholder:"Cashflow",value:e.CF,onChange:function(e){return t(e,"CF")}})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"number",placeholder:"Investissements",value:e.Inv,onChange:function(e){return t(e,"Inv")}}))))},V=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).handleNumInput=function(e,t,n){var r=""!==t?parseInt(t):"",s=a.state;s.formulaires[e][n]=r,s.formulaires[e].EBITDA=s.formulaires[e].CA-s.formulaires[e].FA-s.formulaires[e].CS-s.formulaires[e].FG-s.formulaires[e].AF,a.setState(s)},a.handleDateInput=function(e,t,n){var r=a.state;r.formulaires[e][n]=t,a.setState(r)},a.convertDateToHtml=function(e){var t=new Date(e),a=("0"+(t.getMonth()+1)).slice(-2),n=t.getDate();return t.getFullYear()+"-"+a+"-"+n},a.sendUpdateFormulaire=function(e){var t=e;for(var n in t.date=new Date(t.date).toJSON(),t)""===t[n]&&delete t[n];a.props.dispatch(A(t))},a.SaveAllChanges=function(){for(var e in a.state.formulaires)a.sendUpdateFormulaire(a.state.formulaires[e]);a.props.history.push("/")},a.AddFormulaire=function(){var e={societeId:a.props.match.params.id,date:"",CA:"",FA:"",CS:"",FG:"",AF:"",EBITDA:"",CCT:"",CLT:"",CF:"",Inv:""},t=a.state;t.formulaires.push(e),a.setState(t)},a.isUserSocAdmin=function(){return!!a.props.societe&&!!a.props.societe.admins.some(function(e){return e===a.props.user.login.id})},a.state={formulaires:[{societeId:a.props.match.params.id,date:"",CA:"",FA:"",CS:"",FG:"",AF:"",EBITDA:"",CCT:"",CLT:"",CF:"",Inv:""}]},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(I(this.props.match.params.id))}},{key:"componentWillReceiveProps",value:function(e){}},{key:"componentDidUpdate",value:function(){this.props.societe&&!this.isUserSocAdmin()&&this.props.history.push("/")}},{key:"renderFormulaires",value:function(){var e=this;return this.state.formulaires.map(function(t,a){return r.a.createElement(H,Object.assign({key:a,formId:a},t,{handleNum:e.handleNumInput,handleDate:e.handleDateInput}))})}},{key:"render",value:function(){return this.isUserSocAdmin()?r.a.createElement("div",{className:"AddFormPageContent"},r.a.createElement("h2",null,"Ajout de formulaires"),r.a.createElement("div",{className:"AddFormList"},this.renderFormulaires()),r.a.createElement("div",{className:"Btn"},r.a.createElement("a",{onClick:this.SaveAllChanges},"Enregistrer"),r.a.createElement("a",{onClick:this.AddFormulaire},"Ajouter un formulaire"))):null}}]),t}(n.Component);var J=Object(o.b)(function(e){return{societe:e.societes.societe}})(V),Y=function(e){function t(){var e,a;Object(E.a)(this,t);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(a=Object(b.a)(this,(e=Object(C.a)(t)).call.apply(e,[this].concat(s)))).state={email:"",password:"",privileges:0,error:""},a.handleInputEmail=function(e){a.setState({email:e.target.value})},a.handleInputPassword=function(e){a.setState({password:e.target.value})},a.handleInputPrivileges=function(e){var t="1"===e.target.value?1:0;a.setState({privileges:t})},a.submitForm=function(e){e.preventDefault(),a.setState({error:""}),a.props.dispatch(function(e,t){var a=F.a.post("/api/register",e);return function(e){a.then(function(a){var n=a.data,r=n.success?[].concat(Object(y.a)(t),[n.user]):t,s={success:n.success,users:r};e({type:"USER_REGISTER",payload:s})})}}({email:a.state.email,password:a.state.password,privileges:a.state.privileges},a.props.user.users))},a.showUsers=function(e){return e.users?e.users.map(function(e){return r.a.createElement("tr",{key:e._id},r.a.createElement("td",null,e.email),r.a.createElement("td",null,e.privileges?"administrateur":"utilisateur"))}):null},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(O())}},{key:"componentWillReceiveProps",value:function(e){!1===e.user.register?this.setState({error:"Error,try again"}):this.setState({email:"",password:"",privileges:0})}},{key:"render",value:function(){var e=this.props.user;return r.a.createElement("div",{className:"PageContent"},r.a.createElement("div",{className:"rl_container article"},r.a.createElement("form",{onSubmit:this.submitForm},r.a.createElement("h2",null,"Ajouter un utilisateur"),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"email",placeholder:"Email",value:this.state.email,onChange:this.handleInputEmail})),r.a.createElement("div",{className:"form_element"},r.a.createElement("input",{type:"password",placeholder:"Mot de passe",value:this.state.password,onChange:this.handleInputPassword})),r.a.createElement("div",{className:"form_element"},r.a.createElement("select",{value:this.state.privileges,onChange:this.handleInputPrivileges},r.a.createElement("option",{value:"0"},"utilisateur"),r.a.createElement("option",{value:"1"},"administrateur"))),r.a.createElement("button",{type:"submit"},"Enregistrer"),r.a.createElement("div",{className:"error"},this.state.error)),r.a.createElement("div",{className:"current_users"},r.a.createElement("h4",null,"Utilisateurs existants:"),r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Email"),r.a.createElement("th",null,"Privileges"))),r.a.createElement("tbody",null,this.showUsers(e))))))}}]),t}(n.PureComponent);var Q=Object(o.b)(function(e){return{user:e.user}})(Y),z=a(321),K=a(324),q=a(326),X=a(318),Z=a(319),$=a(325),ee=a(322),te=a(137),ae=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).state={toShow:{CA:!0,FA:!0,CS:!0,FG:!0,AF:!0,EBITDA:!0,CCT:!0,CLT:!0,CF:!0,Inv:!0}},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(N(this.props.match.params.id)).then(function(){})}},{key:"componentWillReceiveProps",value:function(e){var t=e.formulaires;for(var a in t)t[a].date=new Date(t[a].date).toLocaleDateString();this.setState(Object(h.a)({},this.state,{data:t}))}},{key:"handleFieldSelect",value:function(e){var t=this.state;t.toShow[e.target.name]=e.target.checked,this.setState(t)}},{key:"renderFieldSelect",value:function(){var e=this,t=Object.keys(this.state.toShow).map(function(t){return r.a.createElement("div",{className:"CheckboxesGraphElem",key:t},r.a.createElement("label",null,t," : "),r.a.createElement("input",{type:"checkbox",name:t,checked:e.state.toShow[t],onChange:function(t){return e.handleFieldSelect(t)}}))});return r.a.createElement("div",{className:"CheckboxesGraph"},t)}},{key:"renderGraph",value:function(){var e=this,t={CA:"#800000",FA:"#000075",CS:"#f032e6",FG:"#3cb44b",AF:"#ffe119",EBITDA:"#42d4f4",CCT:"#f58231",CLT:"#0000ff",CF:"#000000",Inv:"#ff0000"},a=Object.keys(this.state.toShow).map(function(a,n){return e.state.toShow[a]?r.a.createElement(z.a,{key:n,type:"monotone",dataKey:a,stroke:t[a]}):null});return this.props.formulaires?r.a.createElement("div",{className:"FormGraph"},r.a.createElement(K.a,{width:"100%",aspect:2.2},r.a.createElement(q.a,{width:600,height:300,data:this.state.data,margin:{top:5,right:30,left:20,bottom:5}},r.a.createElement(X.a,{dataKey:"date"}),r.a.createElement(Z.a,null),r.a.createElement($.a,{strokeDasharray:"3 3"}),r.a.createElement(ee.a,null),r.a.createElement(te.a,null),a))):null}},{key:"render",value:function(){return r.a.createElement("div",{className:"GraphContainer"},this.renderFieldSelect(),this.renderGraph())}}]),t}(n.Component);var ne=Object(o.b)(function(e){return{formulaires:e.formulaires.list}})(ae),re=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).handleInput=function(e){a.setState({email:e.target.value})},a.submitForm=function(e){e.preventDefault();var t=a.props.users.filter(function(e){return e.email===a.state.email});a.props.returnUser(t[0])},a.state={email:""},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{className:"form_element userSelector"},r.a.createElement("input",{type:"text",placeholder:"email ".concat(this.props.children),id:"AddUser",value:this.state.email,onChange:this.handleInput}),r.a.createElement("div",{className:"Btn"},r.a.createElement("a",{onClick:this.submitForm},"+"))))}}]),t}(n.Component),se=function(e){var t;return r.a.createElement("div",{className:"current_users"},r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,e.header))),r.a.createElement("tbody",null,e.users&&(t=e.users).length>0?t.map(function(e){return r.a.createElement("tr",{key:e._id},r.a.createElement("td",null,e.email))}):null)))},ie=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).handleInput=function(e,t){var n=a.state;n.societe[t]=e.target.value,a.setState(n)},a.submitForm=function(e){var t;e.preventDefault(),a.props.dispatch((t=a.state.societe,{type:"UPDATE_SOCIETE",payload:F.a.post("/api/updateSociete",t).then(function(e){return e.data})})),a.props.history.push("/")},a.addSocAdmin=function(e){if(!e||!a.state.societe)return null;if(!a.state.societe.admins.some(function(t){return t===e._id})){var t=a.state;t.societe.admins=t.societe.admins.concat(e._id),t.societe.users=t.societe.users.filter(function(t){return t!==e._id}),a.setState(t)}},a.addSocUser=function(e){if(!e||!a.state.societe)return null;if(!a.state.societe.users.some(function(t){return t===e._id})&&!a.state.societe.admins.some(function(t){return t===e._id})){var t=a.state;t.societe.users=t.societe.users.concat(e._id),a.setState(t)}},a.getUsersById=function(e){return a.props.user.users?a.props.user.users.length?a.props.user.users.filter(function(t){return e.some(function(e){return e===t._id})}):e.some(function(e){return e===a.props.user.users._id}):null},a.deleteSociete=function(){var e;window.confirm("La soci\xe9t\xe9 et ses formulaires vont \xeatre supprim\xe9s. \n\xcates-vous s\xfbr de votre choix? (ce changement est d\xe9finitif)")&&(a.props.dispatch((e=a.props.societe._id,{type:"DELETE_SOCIETE",payload:F.a.delete("/api/deleteSociete",{params:{id:e}}).then(function(e){return e.data})})),a.props.history.push("/"))},a.isUserSocAdmin=function(){return!!a.state.societe.admins.some(function(e){return e===a.props.user.login.id})},a.state={societe:{id:"",name:"",adresse:"",PDC:"",admins:[],users:[]}},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(I(this.props.match.params.id)).then(function(){}),this.props.dispatch(O())}},{key:"componentWillReceiveProps",value:function(e){this.setState({societe:e.societe})}},{key:"render",value:function(){var e=this;return""!==this.state.societe.name?r.a.createElement("div",{className:"PageContent"},r.a.createElement("div",{className:"rl_container EditFormContainer EditSociete"},r.a.createElement("form",{onSubmit:this.submitForm},r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Nom : "),r.a.createElement("input",{type:"text",id:"name",value:this.state.societe.name,onChange:function(t){return e.handleInput(t,"name")},disabled:this.isUserSocAdmin()?"":"disabled"})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Adresse : "),r.a.createElement("input",{type:"text",id:"adresse",value:this.state.societe.adresse,onChange:function(t){return e.handleInput(t,"adresse")},disabled:this.isUserSocAdmin()?"":"disabled"})),r.a.createElement("div",{className:"form_element"},r.a.createElement("label",null,"Personne de contact : "),r.a.createElement("input",{type:"text",id:"PDC",value:this.state.societe.PDC,onChange:function(t){return e.handleInput(t,"PDC")},disabled:this.isUserSocAdmin()?"":"disabled"})),this.isUserSocAdmin()?r.a.createElement(re,{users:this.props.user.users,returnUser:this.addSocAdmin},"administrateur"):null,r.a.createElement(se,{users:this.getUsersById(this.state.societe.admins),header:"Administrateurs",disabled:this.isUserSocAdmin()?"enabled":"disabled"}),this.isUserSocAdmin()?r.a.createElement(re,{users:this.props.user.users,returnUser:this.addSocUser},"utilisateur"):null,r.a.createElement(se,{users:this.getUsersById(this.state.societe.users),header:"Utilisateurs",disabled:this.isUserSocAdmin()?"enabled":"disabled"}),this.isUserSocAdmin()?r.a.createElement("div",{className:"Buttons"},r.a.createElement("div",{className:"Btn"},r.a.createElement("a",{onClick:this.submitForm},"Enregistrer")),r.a.createElement("div",{className:"Btn"},r.a.createElement("a",{onClick:this.deleteSociete},"Supprimer la soci\xe9t\xe9"))):null))):null}}]),t}(n.Component);var le=Object(o.b)(function(e){return{societe:e.societes.societe}})(ie),oe=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).handleselectedFile=function(e){a.setState({selectedFile:e.target.files[0],loaded:0,societeId:"5c4f28897e19e41c4c4fc80d"})},a.submitForm=function(e){e.preventDefault();var t=new FormData;t.append("file",a.state.selectedFile,a.state.selectedFile.name),t.append("societeId",a.state.societeId),F.a.post("/api/CSVFormulaires",t,{onUploadProgress:function(e){a.setState({loaded:e.loaded/e.total*100})}}).then(function(e){})},a.getFormulairesCsv=function(){F.a.get("/api/CSVformulairesBySociete",{params:{id:a.state.societeId,order:"asc"}}).then(function(e){})},a.state={selectedFile:null,loaded:0,societeId:"5c4f28897e19e41c4c4fc80d"},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"rl_container article"},r.a.createElement("form",{onSubmit:this.submitForm},r.a.createElement("h2",null,"Uploader des soci\xe9t\xe9s par CSV"),r.a.createElement("input",{type:"file",name:"file",onChange:this.handleselectedFile}),r.a.createElement("button",{type:"submit"},"Upload")),r.a.createElement("p",null,Math.round(this.state.loaded,2)," % upload\xe9"),r.a.createElement("p",null,r.a.createElement("button",{onClick:this.getFormulairesCsv},"Get formulaires CSV")))}}]),t}(n.Component),ce=a(155),ue=a.n(ce);var me=Object(o.b)(function(e){return{user:e.user}})(function(e,t){t.user;var a=[{type:"navItem",icon:"home",text:"Accueil",link:"/",restricted:!0},{type:"navItem",icon:"user-plus",text:"Nouvel utilisateur (admin)",link:"/user/register",restricted:!0,admin:!0},{type:"navItem",icon:"sign-in",text:"Connexion",link:"/login",restricted:!1,exclude:!0},{type:"navItem",icon:"sign-out",text:"D\xe9connexion",link:"/logout",restricted:!0},{type:"navItem",icon:"file-text-o",text:"Nouvelle soci\xe9t\xe9",link:"/societe/add",restricted:!0}],n=function(t,a){return r.a.createElement("div",{key:a,className:t.type},r.a.createElement(l.b,{to:t.link,onClick:e.onHideNav},r.a.createElement(D.a,{name:t.icon}),t.text))};return r.a.createElement("div",null,e.user.login?a.map(function(t,a){return e.user.login.isAuth?t.exclude?null:e.user.login.privileges||!t.admin?n(t,a):null:t.restricted?null:n(t,a)}):null)}),de=function(e){return r.a.createElement(ue.a,{showNav:e.showNav,onHideNav:e.onHideNav,navStyle:{background:"#36616C",width:"50%",maxWidth:"15em"}},r.a.createElement(me,{onHideNav:e.onHideNav}),r.a.createElement("div",null))};var pe=Object(o.b)(function(e){return{user:e.user}})(function(e,t){t.user;return r.a.createElement("div",{className:"ConnectedUser"},e.user.login?e.user.login.email:null)}),he=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(b.a)(this,Object(C.a)(t).call(this,e))).onHideNav=function(){a.setState({showNav:!1})},a.state={showNav:!1},a}return Object(g.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("header",null,r.a.createElement("div",{className:"open_nav"},r.a.createElement(D.a,{name:"bars",onClick:function(){return e.setState({showNav:!0})},style:{color:"lightGray",padding:"8pt",cursor:"pointer"}})),r.a.createElement(pe,null),r.a.createElement(l.b,{to:"/",className:"logo"},"Digitech TP")),r.a.createElement(de,{showNav:this.state.showNav,onHideNav:function(){return e.onHideNav()}}))}}]),t}(n.Component),fe=function(e){return r.a.createElement("div",null,r.a.createElement(he,null),e.children)},Ee=function(e,t){var a=function(a){function n(e){var t;return Object(E.a)(this,n),(t=Object(b.a)(this,Object(C.a)(n).call(this,e))).state={loading:!0},t}return Object(g.a)(n,a),Object(v.a)(n,[{key:"componentWillMount",value:function(){this.props.dispatch({type:"USER_AUTH",payload:F.a.get("/api/auth").then(function(e){return e.data})})}},{key:"componentWillReceiveProps",value:function(e){this.setState({loading:!1}),e.user.login.isAuth?!1===t&&this.props.history.push("/"):t&&this.props.history.push("/login")}},{key:"render",value:function(){return this.state.loading?r.a.createElement("div",{className:"loader"},"Chargement"):r.a.createElement(e,Object.assign({},this.props,{user:this.props.user}))}}]),n}(n.Component);return Object(o.b)(function(e){return{user:e.user}})(a)},ve=function(){return r.a.createElement(fe,null,r.a.createElement(l.d,null,r.a.createElement(l.c,{path:"/",exact:!0,component:Ee(w,!0)}),r.a.createElement(l.c,{path:"/login",exact:!0,component:Ee(B,!1)}),r.a.createElement(l.c,{path:"/logout",exact:!0,component:Ee(R,!0)}),r.a.createElement(l.c,{path:"/user/register",exact:!0,component:Ee(Q,!0)}),r.a.createElement(l.c,{path:"/societe/add",exact:!0,component:Ee(P,!0)}),r.a.createElement(l.c,{path:"/societe/:id",exact:!0,component:Ee(le,!0)}),r.a.createElement(l.c,{path:"/formulaire/:id",exact:!0,component:Ee(W,!0)}),r.a.createElement(l.c,{path:"/addFormulaires/:id",exact:!0,component:Ee(J,!0)}),r.a.createElement(l.c,{path:"/societeGraph/:id",exact:!0,component:Ee(ne,!0)}),r.a.createElement(l.c,{path:"/uploadCsvSociete",exact:!0,component:Ee(oe,!0)})))},be=Object(c.a)(m.a,p.a)(c.d);i.a.render(r.a.createElement(o.a,{store:be(f)},r.a.createElement(l.a,null,r.a.createElement(ve,null))),document.getElementById("root"))}},[[157,2,1]]]);
//# sourceMappingURL=main.56ce5ef6.chunk.js.map